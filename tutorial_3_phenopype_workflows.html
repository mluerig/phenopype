<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tutorial 3: Image analysis workflow &#8212; phenopype 2.0.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial 4: Setting up and managing projects" href="tutorial_4_managing_projects.html" />
    <link rel="prev" title="Tutorial 2: Interacting with images in phenopype" href="tutorial_2_phenopype_images.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          phenopype</a>
        <span class="navbar-text navbar-version pull-left"><b>2.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/mluerig/phenopype">Phenopype on Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Additional resources</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="tutorial_0.html">How to run tutorials and examples using Jupyter Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_1_python_intro.html">Tutorial 1: A (very) brief python introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_2_phenopype_images.html">Tutorial 2: Interacting with images in phenopype</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial 3: Image analysis workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_4_managing_projects.html">Tutorial 4: Setting up and managing projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_5_references.html">Tutorial 5: Creating and detecting a reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_6_video_analysis.html">Tutorial 6: Video analysis</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Tutorial 3: Image analysis workflow</a><ul>
<li><a class="reference internal" href="#Instructions-for-testing-each-workflow">Instructions for testing each workflow</a></li>
<li><a class="reference internal" href="#Low-throughput-workflow">Low throughput workflow</a></li>
<li><a class="reference internal" href="#High-throughput-worflow">High throughput worflow</a><ul>
<li><a class="reference internal" href="#YAML-syntax">YAML syntax</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="tutorial_2_phenopype_images.html" title="Previous Chapter: Tutorial 2: Interacting with images in phenopype"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Tutorial 2: I...</span>
    </a>
  </li>
  <li>
    <a href="tutorial_4_managing_projects.html" title="Next Chapter: Tutorial 4: Setting up and managing projects"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Tutorial 4: S... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/tutorial_3_phenopype_workflows.ipynb.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Tutorial 3: Image analysis workflow</a><ul>
<li><a class="reference internal" href="#Instructions-for-testing-each-workflow">Instructions for testing each workflow</a></li>
<li><a class="reference internal" href="#Low-throughput-workflow">Low throughput workflow</a></li>
<li><a class="reference internal" href="#High-throughput-worflow">High throughput worflow</a><ul>
<li><a class="reference internal" href="#YAML-syntax">YAML syntax</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Tutorial-3:-Image-analysis-workflow">
<h1>Tutorial 3: Image analysis workflow<a class="headerlink" href="#Tutorial-3:-Image-analysis-workflow" title="Permalink to this headline">¶</a></h1>
<p>Analysis of scientific images can be an iterative process that may require users to go back and forth, trying different processing steps and check how to improve results. Later, when the best functions and appropriate settings are found and efficient data collection has priority, image analysis should be efficient and with minimal user input to increase throughput and reproducibility. In phenopype, users can choose between two different workflows that are useful for different stages in the
process of scientific image analysis:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 37%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Workflow</p></th>
<th class="head"><p>Use case</p></th>
<th class="head"><p>Operation principle</p></th>
<th class="head"><p>Code explicitness</p></th>
<th class="head"><p>Data reproducibility</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Low throughput</strong></p></td>
<td><p>“prototyping” - self education and evaluation on single images and small datasets</p></td>
<td><p>image analysis functions are written and stored in Python</p></td>
<td><p>high</p></td>
<td><p>low</p></td>
</tr>
<tr class="row-odd"><td><p><strong>High throughput</strong></p></td>
<td><p>“production” - default workflow for larger image datasets</p></td>
<td><p>images analysis functions are written and stored in YAML format</p></td>
<td><p>low</p></td>
<td><p>high</p></td>
</tr>
</tbody>
</table>
<p>In the <strong>low throughput</strong> workflow, users write a function stack in directly in Python code. This is recommended for users who wish to familiarize themselves with the basic principles of computer vision or when working with only a handful of images. In contrast, the <strong>high throughput</strong> workflow is for production stage, when image analysis should be efficient and data collection reproducible for other users and scientists. In this tutorial you will learn about the differences between the two
workflows.</p>
<div class="alert alert-block alert-success"><p><strong>Further resources related to the high throughput workflow</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="tutorial_2_phenopype_images.html#Window-control"><span class="std std-ref">Window control covered in Tutorial 2</span></a></p></li>
<li><p><a class="reference external" href="https://mluerig.github.io/phenopype/api.html#pype-high-throughput-function">pype section in the API</a></p></li>
<li><p><a class="reference external" href="https://www.tutorialspoint.com/yaml/yaml_indentation_and_separation.htm">YAML indentation and separation</a>.</p></li>
<li><p><a class="reference external" href="https://mluerig.github.io/phenopype/resources.html#computer-vision">the structure of digital images</a></p></li>
</ul>
</div><div class="section" id="Instructions-for-testing-each-workflow">
<h2>Instructions for testing each workflow<a class="headerlink" href="#Instructions-for-testing-each-workflow" title="Permalink to this headline">¶</a></h2>
<p>Here the goal is to measure lateral armor plating in threespine stickleback (<em>Gasterosteus aculeatus</em>). First we need to draw a mask around posterior region that contains the plates. For that step you should select the boundaries around the area of interest, perform a thresholding operation inside the mask, and retrieve the contours inside. The procedure to extract bone-plate area is the same in all workflows, but workflows differ in the amount of explicit Python code, and in reproducibility.</p>
<center><div style="width:600px; text-align: left"><p><img alt="Phenopype workflow example" src="_images/workflow_example_case.png" /></p>
<p><strong>Fig. 1:</strong> Workflow demonstration using a stained stickleback (<em>Gasterosteus aculeatus</em>) stained with alizarin red. Traits of interest are bone-plate area and shape, and, within the detected plates, pixel intensities that denote bone-density. First, draw a map, the remaining steps are fully automatic.</p>
</div></center></div>
<div class="section" id="Low-throughput-workflow">
<h2>Low throughput workflow<a class="headerlink" href="#Low-throughput-workflow" title="Permalink to this headline">¶</a></h2>
<p>In the low throughput workflow, the output of every function needs to be explicitly passed on to the next step. First we need to use <code class="docutils literal notranslate"><span class="pre">load_image</span></code>, which imports the file as a three-channel numpy array (<em>ndarray</em>), together with image meta data (file name, dimensions, etc.) as a pandas <em>DataFrame</em>. After drawing masking the image to only include the area of interest (i.e. the bone plates), we passt the array and the mask on to the <code class="docutils literal notranslate"><span class="pre">threshold</span></code> function. Thresholding will convert a three
dimensional array into a one dimensional binary array of the same width and hight (white denoting foreground, black denoting background). This array needs to be passed on to the <code class="docutils literal notranslate"><span class="pre">find_contours</span></code> function, which will return a dictionary with the detected contours (i.e. the white areas). Finally, the dataframe can be exported as a csv file with <code class="docutils literal notranslate"><span class="pre">save_contours</span></code>. By passing on the initially created meta-data, this function will also included filename and image dimensions in the exported csv.</p>
<p><img alt="Phenopype prototyping workflow" src="_images/workflow_low.png" /> Fig. 2: Sequence of image analysis in phenopype’s low throughput workflow. Boxes indicate data/information, grey bubbles indicate image phenopype functions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">phenopype</span> <span class="k">as</span> <span class="nn">pp</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;images/stickle1.jpg&quot;</span>

<span class="c1">## load image as array, supply image_data (DataFrame containing meta data)</span>
<span class="n">image</span><span class="p">,</span> <span class="n">image_data</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, run <code class="docutils literal notranslate"><span class="pre">create_mask</span></code> - use left mouse clicks to trace an outline around some of the fish plates, right mouse to remove erroneous points, and finish masking the region with <code class="docutils literal notranslate"><span class="pre">Enter</span></code>. Note that the connection between the last two points is drawn automatically, no need to click on the starting point. Then run all remaining code cells on by one, we will visualize the result at the end.</p>
<center><div style="width:500px; text-align: left"><p><img alt="Create masks" src="_images/masks2.gif" /></p>
</div></center><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## draw mask</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;polygon&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- creating mask
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## thresholding converts multichannel to binary image</span>
<span class="n">image_bin</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">segmentation</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;adaptive&quot;</span><span class="p">,</span>
                                      <span class="n">channel</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">blocksize</span><span class="o">=</span><span class="mi">199</span><span class="p">,</span>
                                      <span class="n">constant</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">df_masks</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- including pixels from 1 drawn masks
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## detect contours ony binary image</span>
<span class="n">contours</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">segmentation</span><span class="o">.</span><span class="n">find_contours</span><span class="p">(</span><span class="n">image_bin</span><span class="p">,</span> <span class="n">df_image_data</span><span class="o">=</span><span class="n">image_data</span><span class="p">,</span>
                                         <span class="n">retrieval</span><span class="o">=</span><span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="n">min_area</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- found 6 contours that match criteria
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## export contours to csv</span>
<span class="n">pp</span><span class="o">.</span><span class="n">export</span><span class="o">.</span><span class="n">save_contours</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">dirpath</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_temp/output&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Save folder _temp/output does not exist - create?.y
- contours saved under _temp/output\contours.csv.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">contours</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filename</th>
      <th>width</th>
      <th>height</th>
      <th>contour</th>
      <th>center</th>
      <th>diameter</th>
      <th>area</th>
      <th>order</th>
      <th>idx_child</th>
      <th>idx_parent</th>
      <th>coords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>stickle1.jpg</td>
      <td>2400</td>
      <td>1600</td>
      <td>1</td>
      <td>(1759, 398)</td>
      <td>50</td>
      <td>741</td>
      <td>parent</td>
      <td>-1</td>
      <td>-1</td>
      <td>[[[1747, 381]], [[1747, 382]], [[1746, 383]], ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>stickle1.jpg</td>
      <td>2400</td>
      <td>1600</td>
      <td>2</td>
      <td>(1678, 386)</td>
      <td>107</td>
      <td>2550</td>
      <td>parent</td>
      <td>-1</td>
      <td>-1</td>
      <td>[[[1636, 354]], [[1635, 355]], [[1635, 356]], ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>stickle1.jpg</td>
      <td>2400</td>
      <td>1600</td>
      <td>3</td>
      <td>(1611, 370)</td>
      <td>61</td>
      <td>863</td>
      <td>parent</td>
      <td>-1</td>
      <td>-1</td>
      <td>[[[1611, 340]], [[1611, 341]], [[1610, 342]], ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>stickle1.jpg</td>
      <td>2400</td>
      <td>1600</td>
      <td>4</td>
      <td>(1580, 373)</td>
      <td>88</td>
      <td>1268</td>
      <td>parent</td>
      <td>-1</td>
      <td>-1</td>
      <td>[[[1579, 329]], [[1579, 332]], [[1578, 333]], ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>stickle1.jpg</td>
      <td>2400</td>
      <td>1600</td>
      <td>5</td>
      <td>(1534, 364)</td>
      <td>119</td>
      <td>3660</td>
      <td>parent</td>
      <td>-1</td>
      <td>-1</td>
      <td>[[[1516, 307]], [[1516, 309]], [[1517, 310]], ...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>stickle1.jpg</td>
      <td>2400</td>
      <td>1600</td>
      <td>6</td>
      <td>(1437, 352)</td>
      <td>166</td>
      <td>9214</td>
      <td>parent</td>
      <td>-1</td>
      <td>-1</td>
      <td>[[[1390, 285]], [[1390, 286]], [[1391, 287]], ...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Next we can visualize the contours found by <code class="docutils literal notranslate"><span class="pre">find_contours</span></code>. Note that we first have to draw them explicitly on a “canvas”, i.e. a background for visualization. We could draw them on the original image, but then it would be unusable for further work. It is therefore good pracctice to make a copy using the <code class="docutils literal notranslate"><span class="pre">copy</span></code> library:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>

<span class="c1">## copy the image</span>
<span class="n">canvas</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="c1">## draw detected contours onto canvas</span>
<span class="n">image_drawn</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_contours</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">df_contours</span><span class="o">=</span><span class="n">contours</span><span class="p">)</span>

<span class="c1">## show convas</span>
<span class="n">pp</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">image_drawn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>While analyzing the image, you can explore output from the different steps to see what is going on. For example, the binary image resulting from the thresholding:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pp</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">image_bin</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="High-throughput-worflow">
<h2>High throughput worflow<a class="headerlink" href="#High-throughput-worflow" title="Permalink to this headline">¶</a></h2>
<p>This is the default workflow to analyse medium and large image datasets in phenopype. Here, instead of writing down our analysis as a sequence of Python code, as we did in the low throughput workflow, we supply the same functions through a configuration file in human readable <code class="docutils literal notranslate"><span class="pre">YAML</span></code> format. This file can then be loaded by phenopype’s <code class="docutils literal notranslate"><span class="pre">pype</span></code> class, which initiates the analysis by triggering three actions:</p>
<ol class="arabic simple">
<li><p>open the YAML configuration file in the default OS text editor</p></li>
<li><p>parse the contained functions and execute them in the sequence</p></li>
<li><p>open a HighGUI window showing the processed image, updates with every step</p></li>
</ol>
<p>After one iteration of all steps, users can evaluate the results and decide to modify the opened configuration file (e.g. either change function parameters or add new functions), and run <code class="docutils literal notranslate"><span class="pre">pype</span></code> again, or to terminate the <code class="docutils literal notranslate"><span class="pre">pype</span></code>-run and save all results. The processed image, any extracted phenotypic information, as well as the modified config-file is stored inside a phenopype <code class="docutils literal notranslate"><span class="pre">container</span></code>, and inside a directory specified with <code class="docutils literal notranslate"><span class="pre">dirpath</span></code>.</p>
<center><div style="width:600px; text-align: left"><p><img alt="Phenopype high throughput workflow" src="_images/workflow_high.png" /></p>
</div></center><div class="alert alert-block alert-danger"><p><strong>IMPORTANT - read before continuing:</strong></p>
<ol class="arabic simple">
<li><p>Window control is as covered in <a class="reference internal" href="tutorial_2_phenopype_images.html#Window-control"><span class="std std-ref">Tutorial 2</span></a>). Don’t use the close button, make sure that the window is selected / highlighted when you use the key combinations to close or interact with it:</p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Enter</span></code> - finish an interactive step / function in <code class="docutils literal notranslate"><span class="pre">pype</span></code>-mode (e.g. creating a mask)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ctrl+Enter</span></code> - close and finish a window in <code class="docutils literal notranslate"><span class="pre">pype</span></code>-mode</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Esc</span></code> - close a window and quit the Phenoype process that invoked it (e.g. a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop - <a class="reference internal" href="tutorial_4_managing_projects.html#Using-pype-with-project-folders"><span class="std std-ref">see Tutorial 4</span></a>). This may also work when the process is frozen.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>At the current stage of development, phenopype cannot handle errors resulting from incorrect yaml syntax (e.g. missing spaces or wrong indentation). Consult the section <a class="reference external" href="#YAML-syntax">YAML-syntax (below)</a> to learn how to correctly modify the configuration files.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">pype</span></code> attempts to facilate rapid processing by calling some functions automatically (e.g. to visualize and export the results). Consult the <a class="reference external" href="https://mluerig.github.io/phenopype/api.html#pype-high-throughput-function">pype section in the API</a> to learn about the most important aspects of the <code class="docutils literal notranslate"><span class="pre">pype</span></code> function.</p></li>
</ol>
</div><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">phenopype</span> <span class="k">as</span> <span class="nn">pp</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;images/stickle1.jpg&quot;</span>

<span class="n">pype_demo</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">pype</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span> <span class="c1"># input - can be also an array or a phenopype directory</span>
        <span class="n">dirpath</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_temp/output&quot;</span><span class="p">,</span> <span class="c1">## directory where output is stored (folder needs to exist)</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;demo&quot;</span><span class="p">,</span> <span class="c1"># name of the  pype routine, appended to all results-files</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;tut3&quot;</span> <span class="c1"># template for the analysis - you can create your own!</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Directory to save phenopype-container output set to parent folder of image:
E:\git_repos\phenopype\tutorials\images
New pype configuration created (tut3.yaml) from phenopype template:
e:\git_repos\phenopype\phenopype\templates\tut3.yaml


------------+++ new pype iteration 2021:03:12 16:44:31 +++--------------


Nothing loaded.
PREPROCESSING
create_mask
- creating mask
SEGMENTATION
threshold
- including pixels from 1 drawn masks
find_contours
- found 6 contours that match criteria
VISUALIZATION
select_canvas
- invalid selection - defaulting to raw image
draw_contours
draw_masks
drawing mask: mask1
EXPORT
save_contours
- contours saved under _temp/output\contours_demo.csv.
save_canvas
- canvas saved under _temp/output\canvas_demo.jpg.
=== AUTOSAVE ===
save_masks
- masks saved under _temp/output\masks_demo.csv.


------------+++ finished pype iteration +++--------------
-------(End with Ctrl+Enter or re-run with Enter)--------




------------+++ new pype iteration 2021:03:12 16:44:40 +++--------------


Nothing loaded.
PREPROCESSING
create_mask
- mask with label mask1 already created (edit/overwrite=False)
SEGMENTATION
threshold
- including pixels from 1 drawn masks
find_contours
- found 6 contours that match criteria
VISUALIZATION
select_canvas
- invalid selection - defaulting to raw image
draw_contours
draw_masks
drawing mask: mask1
EXPORT
save_contours
- contours saved under _temp/output\contours_demo.csv (overwritten).
save_canvas
- canvas saved under _temp/output\canvas_demo.jpg (overwritten).
=== AUTOSAVE ===
save_masks
- masks saved under _temp/output\masks_demo.csv (overwritten).


------------+++ finished pype iteration +++--------------
-------(End with Ctrl+Enter or re-run with Enter)--------




TERMINATE
</pre></div></div>
</div>
<p>Now all results and intermediate data results are saved under <code class="docutils literal notranslate"><span class="pre">&quot;_temp/output&quot;</span></code>, but also contained in a container that is part of the <code class="docutils literal notranslate"><span class="pre">pype</span></code>-object which we called <code class="docutils literal notranslate"><span class="pre">pype_demo</span></code>. You can use it to access e.g. the binary images, as we did in the other workflows above, and visualize it manually:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pp</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">pype_demo</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">image_bin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Of course you can modify the configuration files to change the outcome. For instance, try to change the <code class="docutils literal notranslate"><span class="pre">blocksize</span></code> argument in <code class="docutils literal notranslate"><span class="pre">threshold</span></code> to <code class="docutils literal notranslate"><span class="pre">49</span></code>, or <code class="docutils literal notranslate"><span class="pre">499</span></code>, and see what happens. If you do so while the window is open, phenopype will update the image window and show the updated results.</p>
<div class="section" id="YAML-syntax">
<h3>YAML syntax<a class="headerlink" href="#YAML-syntax" title="Permalink to this headline">¶</a></h3>
<p>The configuration files needed to run the pype are written in yaml (a recursive acronym for “YAML Ain’t Markup Language”). In principle, these are just text files that follows a specific set of rules for indentation and separation. Let’s look at the configuration template for this tutorial that we used above - we can look at <em>all</em> templates using <code class="docutils literal notranslate"><span class="pre">pype_config_templates</span></code>, and inspect a specific template using <code class="docutils literal notranslate"><span class="pre">show_config_template</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">phenopype</span> <span class="k">as</span> <span class="nn">pp</span>

<span class="n">pp</span><span class="o">.</span><span class="n">pype_config_templates</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;demo.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\demo.yaml&#39;,
 &#39;ex1.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex1.yaml&#39;,
 &#39;ex2.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex2.yaml&#39;,
 &#39;ex3.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex3.yaml&#39;,
 &#39;ex5_1.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex5_1.yaml&#39;,
 &#39;ex5_2.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex5_2.yaml&#39;,
 &#39;ex6.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex6.yaml&#39;,
 &#39;ex7.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex7.yaml&#39;,
 &#39;ex8_1.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex8_1.yaml&#39;,
 &#39;ex8_2.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\ex8_2.yaml&#39;,
 &#39;landmarks1.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\landmarks1.yaml&#39;,
 &#39;landmarks2.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\landmarks2.yaml&#39;,
 &#39;tut3.yaml&#39;: &#39;e:\\git_repos\\phenopype\\phenopype\\templates\\tut3.yaml&#39;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pp</span><span class="o">.</span><span class="n">show_config_template</span><span class="p">(</span><span class="s2">&quot;tut3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SHOWING BUILTIN PHENOPYPE TEMPLATE tut3.yaml


- preprocessing:
  - create_mask:
      tool: polygon
- segmentation:
  - threshold:
      method: adaptive
      blocksize: 199
      constant: 5
      channel: red
  - find_contours:
      retrieval: ext
      min_diameter: 0
      min_area: 150
- visualization:
  - select_canvas:
      canvas: image
  - draw_contours:
      line_width: 2
      label_width: 1
      label_size: 1
      fill: 0.3
  - draw_masks
- export:
  - save_contours:
      overwrite: true
  - save_canvas:
      resize: 0.5
      overwrite: true
</pre></div></div>
</div>
<p>The text inside the yaml configuration files is parsed by Python from top to bottom and converted back to Python code in the background, i.e. to phenopype modules and functions. Indentation hierarchy is as follows:</p>
<ol class="arabic simple">
<li><p>The first level without any indentation, e.g. <code class="docutils literal notranslate"><span class="pre">-preprocessing</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">segmentation</span></code>, denote from the module that a function is part of.</p></li>
<li><p>The second level with two-space indentation before the hyphen, e.g. <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">threshold</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">find_contours</span></code> are functions that are loaded from the <code class="docutils literal notranslate"><span class="pre">segmentation</span></code> module.</p></li>
<li><p>The third level without hyphens, e.g. <code class="docutils literal notranslate"><span class="pre">method:</span> <span class="pre">otsu</span></code> and <code class="docutils literal notranslate"><span class="pre">blocksize:</span> <span class="pre">99</span></code>, are arguments passed on to the function.</p></li>
</ol>
<p>Following this notation, the yaml parser in Python interprets the first item in <code class="docutils literal notranslate"><span class="pre">segmentation</span></code> as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">pp.segmentation.threshold(image,</span> <span class="pre">method=&quot;adaptive&quot;,</span> <span class="pre">blocksize=199,</span> <span class="pre">constant=5,</span> <span class="pre">channel=&quot;red&quot;)</span></code></p>
<p>When running the pype routine, <code class="docutils literal notranslate"><span class="pre">image</span></code> is automatically loaded and passed to all following functions. You can add or remove functions as you like. Note in the hyphenated first two levels you can specify modules and functions as many times as you want (<code class="docutils literal notranslate"><span class="pre">-</span></code> is the yaml list notation). When adding or modifying modules and functions, it is important to keep in mind that the <strong>function stack is executed sequentially</strong>. So, if you want to perform a <code class="docutils literal notranslate"><span class="pre">morphology</span></code> operation on a binary images, it
should come <em>after</em> and not before the main segmentation function (in this case <code class="docutils literal notranslate"><span class="pre">threshold</span></code>).</p>
<div class="alert alert-block alert-info"><p><strong>Here are the most important rules for YAML syntax:</strong></p>
<ul class="simple">
<li><p><strong>indentation rules:</strong></p>
<ul>
<li><p>0 spaces for modules</p></li>
<li><p>2 spaces + hyphen+space in front of functions</p></li>
<li><p>4 spaces in front of arguments</p></li>
</ul>
</li>
<li><p><strong>separation rules:</strong></p>
<ul>
<li><p>modules and functions with arguments are followed by a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>) and a new line</p></li>
<li><p>functions without specified arguments don’t need a colon</p></li>
<li><p>arguments are followed by a colon, a space and then the value</p></li>
</ul>
</li>
<li><p>modules and functions can be emtpy (see<code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">draw_masks</span></code> above), but function arguments <em>cannot</em> be emtpy (e.g. <code class="docutils literal notranslate"><span class="pre">overwrite:</span></code> needs to be <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>)</p></li>
<li><p>as per Python syntax, optional function arguments can, but don’t have to be specified and the functions will just run on default values</p></li>
<li><p>functions can be added multiple times, but sometimes their output may be overwtritten (e.g. <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">threshold</span></code> makes sense only once, but <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">blur</span></code> may be used in multiple locations)</p></li>
</ul>
</div><p>To learn how to analyze entire data sets with the high-throughput method, move on to the next <a class="reference internal" href="tutorial_4_managing_projects.html"><span class="doc">Tutorial 4</span></a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2021, Moritz Lürig.<br/>
      Last updated on May 10, 2021, 5:17:54 PM.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>