<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Tutorial 2: loading phenopype, analyzing single images &#8212; phenopype 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial 3: making a project, configuring pype" href="tutorial_3.html" />
    <link rel="prev" title="Tutorial 1: A (very) brief python introduction" href="tutorial_1.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          phenopype</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/mluerig/phenopype">back to github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="more.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="more.html#opencv">OpenCV</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial_1.html">Tutorial 1: A (very) brief python introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial 2: loading phenopype, analyzing single images</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_3.html">Tutorial 3: making a project, configuring pype</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_3.html#Set-up-project">Set up project</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_4.html">Tutorial 4: setting a (global) size and colour reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_4.html#Set-up-project">Set up project</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_5.html">Tutorial 5: motion tracking from videos</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_1.html">Example 1: detecting objects, measuring shape and colour</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_2.html">Example 2: setting masks and drawing</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_3.html">Example 3: setting landmarks and poly-lines</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Tutorial 2: loading phenopype, analyzing single images</a><ul>
<li><a class="reference internal" href="#Add-images-to-project">Add images to project</a></li>
<li><a class="reference internal" href="#Setting-a-scale">Setting a scale</a></li>
<li><a class="reference internal" href="#Detecting-objects">Detecting objects</a></li>
<li><a class="reference internal" href="#Masking-images">Masking images</a></li>
<li><a class="reference internal" href="#Detecting-many-objects">Detecting many objects</a></li>
<li><a class="reference internal" href="#Detecting-many-objects-in-many-files">Detecting many objects in many files</a></li>
<li><a class="reference internal" href="#Detect-objects-on-variable-background">Detect objects on variable background</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="tutorial_1.html" title="Previous Chapter: Tutorial 1: A (very) brief python introduction"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Tutorial 1: A...</span>
    </a>
  </li>
  <li>
    <a href="tutorial_3.html" title="Next Chapter: Tutorial 3: making a project, configuring pype"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Tutorial 3: m... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/tutorial_2.ipynb.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Tutorial-2:-loading-phenopype,-analyzing-single-images">
<h1>Tutorial 2: loading phenopype, analyzing single images<a class="headerlink" href="#Tutorial-2:-loading-phenopype,-analyzing-single-images" title="Permalink to this headline">¶</a></h1>
<p>This example demonstrates core <em>phenopype</em> functionality by showing how multiple objects can be found and extracted from images by applying different <strong>thresholding algorithms</strong>. Furthermore it is shown how a scale is set, i.e. information from <strong>size reference cards</strong> is digitized, and how parts of images are masked to <strong>exclude unwanted objects</strong> from the object detection procedure.</p>
<p>The images used for this tutorial contain isopods sitting inside a white tray underneath a camera stand, photopgraphed with a 50 mm lens on a Canon 750D. ** <a class="reference external" href="#add">Add images to project</a> * <a class="reference external" href="#scale">Setting a scale</a> * <a class="reference external" href="#objectfinder">Detecting objects</a> * <a class="reference external" href="#mask">Masking images</a> * <a class="reference external" href="#object2">Detecting many objects</a> * <a class="reference external" href="#object3">Detecting many objects in many files</a> * <a class="reference external" href="#object4">Detecting objects on variable background</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">phenopype</span> <span class="k">as</span> <span class="nn">pp</span>

<span class="c1">## for this tutorial, you should be in the &quot;tutorial directory of phenopype-master&quot;</span>
<span class="c1">#os.getcwd()</span>
<span class="c1">#os.chdir(&quot;tutorials&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="Add-images-to-project">
<h2>Add images to project<a class="headerlink" href="#Add-images-to-project" title="Permalink to this headline">¶</a></h2>
<p>In python, we can use <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">as</span></code> to load packages and call them with shorter bindings. E.g. we can type <code class="docutils literal notranslate"><span class="pre">pp</span></code> instead of <code class="docutils literal notranslate"><span class="pre">phenopype</span></code> everytime we call a function. Next we specificy the folder containing the images, making a project object that contains all the image names and paths. The function <code class="docutils literal notranslate"><span class="pre">project_maker</span></code> will then collect all files that match your specifications (filetypes or names).</p>
<p>For this first simple example, we only want to include the image named “bug1.jpg”. We can do so using <code class="docutils literal notranslate"><span class="pre">include</span></code> (or, <code class="docutils literal notranslate"><span class="pre">exclude</span></code> to skip images whose filenames contain this string). Note that this can be any sub-string and does not have to be the whole filename, so in this case “bug1” will suffice.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_proj</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">project_maker</span><span class="p">(</span><span class="n">image_dir</span> <span class="o">=</span> <span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bug1&quot;</span><span class="p">],</span> <span class="n">name</span> <span class="o">=</span><span class="s2">&quot;Demo project&quot;</span><span class="p">)</span>

<span class="c1"># HINT: image_dir can be relative or absolute</span>
<span class="c1"># e.g. something like &quot;your_download_directory//phenopype-master//tutorials//images&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


----------------------------------------------------------------
Project settings
================

Project name: Demo project
Image directory: images
Search mode: dir
Filetypes: []
Include:[&#39;bug1&#39;]
Exclude: []
----------------------------------------------------------------
Search returned following files:
[&#39;bug1.jpg&#39;]
</pre></div></div>
</div>
<p>Let’s have a quick look at the image using the collected absolute filepaths (accessible from the <code class="docutils literal notranslate"><span class="pre">my_proj</span></code> object) and the <em>phenopye</em> function <code class="docutils literal notranslate"><span class="pre">show_img</span></code> (contains all the <code class="docutils literal notranslate"><span class="pre">opencv</span></code> GUI controls explained in <a class="reference external" href="0_python_intro.ipynb#images">the python intro</a>. Close the image by hitting enter or closing the window:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">img_path</span> <span class="o">=</span> <span class="n">my_proj</span><span class="o">.</span><span class="n">filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pp</span><span class="o">.</span><span class="n">show_img</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Setting-a-scale">
<h2>Setting a scale<a class="headerlink" href="#Setting-a-scale" title="Permalink to this headline">¶</a></h2>
<p>Our image contains an organism, as well as a reference card for colour and size. To make our measurements meaningful, we need to know the the pixel-to-mm-ratio. To do so we we load the image into the <code class="docutils literal notranslate"><span class="pre">scale_maker</span></code>, <code class="docutils literal notranslate"><span class="pre">zoom</span></code> into the scale area for better visibility, and mark the distance we specifiy - in this case 10 mm.</p>
<p><strong>HINT:</strong> The default mode for marking the scale is by dragging a box/rectangle around the object. However, you can also specify points to draw a polygon.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><ul class="simple">
<li></li>
</ul>
</th>
<th class="head"><ul class="simple">
<li></li>
</ul>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><img alt="image0" src="../assets/tutorials/make_scale.gif" /></p></td>
<td><p><img alt="image1" src="../assets/tutorials/scale.png" /></p></td>
</tr>
</tbody>
</table>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">scale</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">scale_maker</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">img_path</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Mark the outline of the scale by left clicking, remove points by right clicking, finish with enter.
Finished, scale outline drawn. Now add the scale by clicking on two points with a known distance between them:
Adding point 1 of 2 to scale
Adding point 2 of 2 to scale


------------------------------------------------
Finished - your scale has 956 pixel per 10 mm.
------------------------------------------------


</pre></div></div>
</div>
<p>We can access the scale by calling its variable <code class="docutils literal notranslate"><span class="pre">measured</span></code>, which always will give you the ratio of <strong>pixels per 1 mm</strong>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">scale</span><span class="o">.</span><span class="n">measured</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
95.3
</pre></div></div>
</div>
</div>
<div class="section" id="Detecting-objects">
<h2>Detecting objects<a class="headerlink" href="#Detecting-objects" title="Permalink to this headline">¶</a></h2>
<p>Finding objects inside an image is a core function of <em>phenopype</em>. Results depend on how “good” your pictures are with respect to foreground contrast of your objects, homogeneity of your background, and overall illumination and resolution. The pictures we have loaded above are pretty good for that purpose. However, don’t give up just now if your images have less ideal contrast or a noisy background. <em>phenopype</em> comes with a flavor of different preprossing strategies and well established
<a class="reference external" href="https://docs.opencv.org/3.4/d7/d4d/tutorial_py_thresholding.html">thresholding algorithms in opencv</a>, wrapped into a simple method: the <code class="docutils literal notranslate"><span class="pre">object_finder</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">help</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">object_finder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on class object_finder in module phenopype.base:

class object_finder(builtins.object)
 |  object_finder(image)
 |
 |  Initialize object finder class, loads image.
 |
 |  Parameters
 |  ----------
 |
 |  image: str or array
 |      absolute or relative path to OR numpy array of image containing the objects
 |
 |  Methods defined here:
 |
 |  __init__(self, image)
 |      Initialize self.  See help(type(self)) for accurate signature.
 |
 |  find_objects(self, **kwargs)
 |      Method in object finder class: find objects in colour or grayscale images using thresholding
 |
 |      Parameters
 |      ----------
 |      thresholding: list (default: [&#34;otsu&#34;])
 |          determines the type of thresholding:
 |              - &#34;binary&#34; needs an interger for the threshold value (default: 127),
 |              - &#34;adaptive&#34; needs odd integer for blocksize (default: 99) and constant to be subtracted (default 1)
 |              - for more info see https://docs.opencv.org/3.4.4/d7/d4d/tutorial_py_thresholding.html
 |      operations: list (default: [&#34;diameter&#34;, &#34;area&#34;])
 |          determines the type of operations to be performed on the detected objects:
 |              - &#34;diameter&#34; of the bounding circle of our object
 |              - &#34;area&#34; within the contour of our object
 |              - &#34;grayscale&#34; mean and standard deviation of grayscale pixel values inside the object contours
 |              - &#34;bgr&#34; mean and standard deviation of blue, green and red pixel values inside the object contours
 |              - &#34;skeletonize&#34; attempts to transform object into a skeleton form using the technique of Zhang-Suen. WARNING: can be slow for large objects
 |      scale: num (1)
 |          pixel to mm-ratio
 |      mode: str (default: &#34;multiple&#34;)
 |          detect all, or only [&#34;single&#34;] largest object or multiple
 |      mask: list
 |          phenoype mask-objects (lists of boolean mask, label, and include-argument) to include or exclude an area from the procedure
 |      show: bool (default: True)
 |          display the detection results
 |      blur1: int
 |          first pass blurring kernel size (before thresholding)
 |      blur2: list
 |          second pass blurring kernel size (after thresholding) and binary thresholding value (default 127)
 |      min_diam: int
 |          minimum diameter (longest distance in contour) in pixels for objects to be included (default: 0)
 |      min_area: int
 |          minimum contour area in pixels for objects to be included (default: 0)
 |      corr_factor: int
 |          factor (in px) to add to (positive int) or subtract from (negative int) object (default: 0)
 |      resize: in (0.1-1)
 |          resize image to speed up detection process - usually not recommended
 |      gray_value_ref: int (0-255)
 |          reference gray scale value to adjust the given picture&#39;s histogram to
 |
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |
 |  __dict__
 |      dictionary for instance variables (if defined)
 |
 |  __weakref__
 |      list of weak references to the object (if defined)

</pre></div></div>
</div>
<p>Just like <code class="docutils literal notranslate"><span class="pre">project_maker</span></code> or <code class="docutils literal notranslate"><span class="pre">scale_maker</span></code>, <code class="docutils literal notranslate"><span class="pre">object_finder</span></code> is a <a class="reference external" href="https://docs.python.org/3.7/tutorial/classes.html">class</a>, that means we have to initialize it first, and then run the actual method. After initializing it by giving it a path to our image (alternatively: an array), we can detect objects using <code class="docutils literal notranslate"><span class="pre">find_objects</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">of</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">object_finder</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">img_path</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Warning - no scale specified
     diameter  area
idx
1           7    24
2          19    67
3          15     8
4          17    16
5          13    16
..        ...   ...
169        48   371
170        24    46
171        74   111
172        12    19
173         9    13

[173 rows x 2 columns]


----------------------------------------------------------------
Found 1259 objects in bug1.jpg:
  ==&gt; 173 are valid objects
    - 1086 are noise
----------------------------------------------------------------
</pre></div></div>
</div>
</div>
<div class="section" id="Masking-images">
<h2>Masking images<a class="headerlink" href="#Masking-images" title="Permalink to this headline">¶</a></h2>
<p>Ok, this is not right, the algorithm is picking up our reference card. We need to only include our organism in our image by applying a mask to be included. This we can do with the class <code class="docutils literal notranslate"><span class="pre">mask_maker</span></code> that we need to initialize with a picture, and then apply the <code class="docutils literal notranslate"><span class="pre">draw_mask()</span></code> function. This method works cumulatively, meaning that we can include or exclude multiple areas <strong>after</strong> the first mask is drawn.</p>
<p><strong>HINT:</strong> We can use <code class="docutils literal notranslate"><span class="pre">&quot;rectangle&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;polygon&quot;</span></code> mode to draw our mask.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mm</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">mask_maker</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
<span class="n">mask1</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">draw_mask</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rectangle&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mask2</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">draw_mask</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;polygon&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mask3</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">draw_mask</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rectangle&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Mark the outline of your arena, i.e. what you want to include in the image analysis by left clicking, finish with enter.

Mark the outline of your arena, i.e. what you want to include in the image analysis by left clicking, finish with enter.
Adding point #1 with position(2127,866) to arena
Adding point #2 with position(1821,2193) to arena
Adding point #3 with position(1400,1253) to arena

Mark the outline of your arena, i.e. what you want to include in the image analysis by left clicking, finish with enter.
</pre></div></div>
</div>
<p>The masks can the be passed on the the <code class="docutils literal notranslate"><span class="pre">object_finder</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">mask3</span><span class="p">])</span> <span class="c1"># NOTE: your mask should be inside a list -&gt; []</span>
</pre></div>
</div>
</div>
<p>The next problem is, that our organism is being recognized as many small objects. If we only have one organism in our image, we can switch to the <code class="docutils literal notranslate"><span class="pre">mode</span></code> “single”. Also, we want to disregard legs and antenna. The removal of small structures can be accomplished by adding some gaussian noise to the image with the <code class="docutils literal notranslate"><span class="pre">blur1</span></code> variable (<code class="docutils literal notranslate"><span class="pre">blur1</span></code> = first pass blurring, <code class="docutils literal notranslate"><span class="pre">blur2</span></code> = second pass blurring). The provided number of the size of your blur kernel in pixels (bigger = more blurred). At this
point we should also include the scale we measured earlier:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">mask3</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="n">blur1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">.</span><span class="n">measured</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>What we see in the console is just for evalution and does not show us much information. To see at what we actually measured, let’s look at the <code class="docutils literal notranslate"><span class="pre">results</span></code> object, which contains some metadata, and the phenotypic information.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span>
</pre></div>
</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>filename</p></td>
<td><p>name of the image file</p></td>
</tr>
<tr class="row-odd"><td><p>date_taken</p></td>
<td><p>timestamp of when your image was taken. (y-m-d h-m-s), or NA</p></td>
</tr>
<tr class="row-even"><td><p>date_analyzed</p></td>
<td><p>timestamp of when your image was analyzed (i.e., current time). (y-m-d h-m-s)</p></td>
</tr>
<tr class="row-odd"><td><p>idx</p></td>
<td><p>if you have multiple objects in your image, this will correspond to the labels</p></td>
</tr>
<tr class="row-even"><td><p>resize_factor</p></td>
<td><p>sometimes it is necessary to resize large images. this keeps track of it</p></td>
</tr>
<tr class="row-odd"><td><p>scale</p></td>
<td><p>the provided scale, number of pixels per 1 mm</p></td>
</tr>
<tr class="row-even"><td><p>diameter</p></td>
<td><p>from the bounding circle of our object</p></td>
</tr>
<tr class="row-odd"><td><p>area</p></td>
<td><p>inside the contour of our object</p></td>
</tr>
</tbody>
</table>
<p>We can measure aditional parameters that we pass on using the <code class="docutils literal notranslate"><span class="pre">operations</span></code> argument - e.g. “bgr”, which returns the mean values for blue, green, and red pixels (for a full list of operations, see <code class="docutils literal notranslate"><span class="pre">help(pp.object_finder)</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">mask3</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="n">blur1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">.</span><span class="n">measured</span><span class="p">,</span> <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;grayscale&quot;</span><span class="p">,</span> <span class="s2">&quot;bgr&quot;</span><span class="p">])</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<p>We can keep running the <code class="docutils literal notranslate"><span class="pre">find_objects</span></code> method until we are happy with our results. Once that is the case, we save both the results data frame using <code class="docutils literal notranslate"><span class="pre">save_csv</span></code>; and the processed image, which we get by accessing <code class="docutils literal notranslate"><span class="pre">image_processed</span></code> in the <code class="docutils literal notranslate"><span class="pre">object_finder</span></code> object, and saving it with <code class="docutils literal notranslate"><span class="pre">save_img</span></code>. As name we use the filename that we get from the <code class="docutils literal notranslate"><span class="pre">my_proj</span></code> object.</p>
<p>Note that by default, text files and images are overwritten if they already exists in the specified directory. Also, if a directory does not exists, it will be created.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">img_name</span> <span class="o">=</span> <span class="n">my_proj</span><span class="o">.</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">pp</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">img_name</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;images_out&quot;</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">save_img</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">of</span><span class="o">.</span><span class="n">image_processed</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">img_name</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;images_out&quot;</span><span class="p">,</span> <span class="n">resize</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="c1"># NOTE: you can resize images with the &quot;resize&quot; argument to save space</span>
</pre></div>
</div>
</div>
<p>You now should be able to handle the <code class="docutils literal notranslate"><span class="pre">object_finder</span></code> class. Below I will introduce more examples and processing steps that can improve results.</p>
</div>
<div class="section" id="Detecting-many-objects">
<h2>Detecting many objects<a class="headerlink" href="#Detecting-many-objects" title="Permalink to this headline">¶</a></h2>
<p>For this example we will load a different set of images.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_proj</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">project_maker</span><span class="p">(</span><span class="n">image_dir</span> <span class="o">=</span> <span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;isopods&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">img_path</span> <span class="o">=</span> <span class="n">my_proj</span><span class="o">.</span><span class="n">filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># we only use the first image</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">scale_maker</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">img_path</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span>  <span class="n">zoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># measure scale</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">of</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">object_finder</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">.</span><span class="n">measured</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Looks terrible. We need to exclude areas, and pass the mask on to <code class="docutils literal notranslate"><span class="pre">find_objects</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">mask_maker</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
<span class="n">mask1</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">draw_mask</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;tray&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rectangle&quot;</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># include the tray area</span>
<span class="n">mask2</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">draw_mask</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rectangle&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># exclude the scale inside the tray area</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">.</span><span class="n">measured</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Still not great, there is a lot of noise and some bugs are not identified properly. We can try some blurring and implementing a minimum diameter.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">.</span><span class="n">measured</span><span class="p">,</span> <span class="n">min_diam</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blur1</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Blurring tends to “eat away” the object borders. We can counteract this by adding a “correction factor” that will add some more area to our objects. <code class="docutils literal notranslate"><span class="pre">corr_factor</span></code> is a list that takes three arguments: [shape, value, iterations]. See <code class="docutils literal notranslate"><span class="pre">help(object_finder)</span></code> for details.</p>
<p>Since we add more “flesh to the bone”, we can also increase the minimum diameter of our objects and also introduce <code class="docutils literal notranslate"><span class="pre">min_area</span></code> to get rid of those small particles. Note that the preview that gets put out after every <code class="docutils literal notranslate"><span class="pre">find_object</span></code> run can help you specify those parameters. E.g. if most objects have around 100 pixels and an area &gt;1000 pixels, we want to set the threshold so that the majority stays in, but the smallest objects get excluded.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">.</span><span class="n">measured</span><span class="p">,</span> <span class="n">min_diam</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">min_area</span><span class="o">=</span><span class="mi">1100</span><span class="p">,</span> <span class="n">blur1</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">corr_factor</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ellipse&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

</pre></div>
</div>
</div>
<p>Ok, this looks good, let’s save the results and the processed image for reference, the <code class="docutils literal notranslate"><span class="pre">idx</span></code> column corresponds to the labels inside the image.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">img_name</span> <span class="o">=</span> <span class="n">my_proj</span><span class="o">.</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">pp</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">img_name</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;images_out&quot;</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">save_img</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">of</span><span class="o">.</span><span class="n">image_processed</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">img_name</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;images_out&quot;</span><span class="p">,</span> <span class="n">resize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Detecting-many-objects-in-many-files">
<h2>Detecting many objects in many files<a class="headerlink" href="#Detecting-many-objects-in-many-files" title="Permalink to this headline">¶</a></h2>
<p>Let’s do this for all the files in our project. Because the tray on which the bugs sit isn’t perfectly centered in each picture, we should mark the boundaries with the <code class="docutils literal notranslate"><span class="pre">polygon_maker</span></code>. However, because the scale is the same in each picture, we can use the <code class="docutils literal notranslate"><span class="pre">detect</span></code> method from the <code class="docutils literal notranslate"><span class="pre">scale_maker</span></code> class. <code class="docutils literal notranslate"><span class="pre">detect</span></code> uses the accelerated KAZE (AKAZE: <a class="reference external" href="https://www.youtube.com/watch?v=lI50PGr2TEU">https://www.youtube.com/watch?v=lI50PGr2TEU</a>) algorithm for feature registration and matching. I will expand more on this in a future version of the
tutorial.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># MAKE FILE LIST</span>

<span class="n">my_proj</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">project_maker</span><span class="p">(</span><span class="n">image_dir</span> <span class="o">=</span> <span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;isopods&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># MARK SCALE ONCE, GET PIXEL RATIO</span>

<span class="n">img_path</span> <span class="o">=</span> <span class="n">my_proj</span><span class="o">.</span><span class="n">filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># we only use the first image</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">scale_maker</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">img_path</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span>  <span class="n">zoom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># measure scale</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># MARK TRAY AREA ONLY, SCALE WILL BE AUTOMATICALLY DETECTED. CONTINUE WITH ENTER</span>

<span class="c1"># loop through both the projects filepaths and filenames using &quot;zip&quot;:</span>
<span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">my_proj</span><span class="o">.</span><span class="n">filepaths</span><span class="p">,</span> <span class="n">my_proj</span><span class="o">.</span><span class="n">filenames</span><span class="p">):</span>

    <span class="c1"># mark the tray for each image. if your picture doesn&#39;t change dramatically, you can skip this</span>
    <span class="n">arena</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">mask_maker</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">mask1</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">draw_mask</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;tray&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rectangle&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># this is a scale detector! if your scale is identical, the scale-finder will find it!</span>
    <span class="n">mask2</span><span class="p">,</span> <span class="n">scale</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">min_matches</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># we use the optimal settings we found above</span>
    <span class="n">of</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">object_finder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">.</span><span class="n">measured</span><span class="p">,</span> <span class="n">min_diam</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">min_area</span><span class="o">=</span><span class="mi">1100</span><span class="p">,</span> <span class="n">blur1</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">corr_factor</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ellipse&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># save after every iteration</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;tutorials</span><span class="se">\\</span><span class="s2">images_out&quot;</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">save_img</span><span class="p">(</span><span class="n">of</span><span class="o">.</span><span class="n">image_processed</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;tutorials</span><span class="se">\\</span><span class="s2">images_out&quot;</span><span class="p">,</span> <span class="n">resize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Detect-objects-on-variable-background">
<h2>Detect objects on variable background<a class="headerlink" href="#Detect-objects-on-variable-background" title="Permalink to this headline">¶</a></h2>
<p>In this example, the background is not homogenous enough for the standard thresholding algorithm, so we need to use different settings.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_proj</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">project_maker</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bug2&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">of</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">object_finder</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">my_proj</span><span class="o">.</span><span class="n">filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="n">blur1</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># does not work</span>
</pre></div>
</div>
</div>
<p>The algorithm fails because the image is full gradients that are invisible to us - we can make them visible if we change the algorithm, and binarize the image.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;adaptive&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">show_img</span><span class="p">(</span><span class="n">of</span><span class="o">.</span><span class="n">thresh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># and now with proper output</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="n">blur1</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;adaptive&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># does work a lot better</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pp</span><span class="o">.</span><span class="n">save_csv</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">my_proj</span><span class="o">.</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;images_out&quot;</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">save_img</span><span class="p">(</span><span class="n">of</span><span class="o">.</span><span class="n">image_processed</span><span class="p">,</span> <span class="n">my_proj</span><span class="o">.</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;images_out&quot;</span><span class="p">,</span> <span class="n">resize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, Moritz Lürig.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>